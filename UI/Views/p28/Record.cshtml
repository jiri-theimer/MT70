@model UI.Models.Record.p28Record
@inject BL.Factory _f

@{

    Layout = "~/Views/Shared/_LayoutRecord.cshtml";
    if (Model.Rec == null) return;
    Model.PageTitle = _f.tra("Karta klienta");
    Model.PageSymbol = BO.Symbol.p28();

}
@addTagHelper *, UI


<div class="tabs_container_record">
    <!-- Tab panes -->
    <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item onetab" role="presentation">
            <a id="link_tab1" class="nav-link" data-bs-toggle="tab" role="tab" href="#tab1">@_f.tra("Karta klienta")</a>
        </li>
        <li class="nav-item onetab" role="presentation">
            <a id="link_tab2" class="nav-link" data-bs-toggle="tab" role="tab" href="#tab2">@_f.tra("Fakturační nastavení")</a>
        </li>
        <li class="nav-item onetab" role="presentation">
            <a id="link_tab3" class="nav-link" data-bs-toggle="tab" role="tab" href="#tab3">@_f.tra("Uživatelská pole") (@Model.ff1.VisibleInputsCount)</a>
        </li>

        <li class="nav-item onetab" role="presentation">
            <a id="link_tab4" class="nav-link" data-bs-toggle="tab" role="tab" href="#tab4">@_f.tra("Ostatní")</a>
        </li>


    </ul>
</div>


<div class="modal_record_container">
    <div class="tab-content">
        <div class="tab-pane" id="tab1" role="tabpanel">
            <!-- Tab1 -->
            <div class="row">
                <div class="col-sm-7 col-md-7">
                    <input type="radio" id="RadioIsIntraPerson1" asp-for="@Model.IsCompany" value="1" onchange="postback('postback')">
                    <label for="RadioIsIntraPerson1">@_f.tra("Klient je společnost/právnická osoba")</label>
                    <br />
                    <input type="radio" id="RadioIsIntraPerson0" asp-for="@Model.IsCompany" value="0" onchange="postback('postback')">
                    <label for="RadioIsIntraPerson0">@_f.tra("Klient je fyzická osoba")</label>
                </div>
                <div class="col-sm-5 col-md-5">

                </div>
            </div>

            <div class="row">
                <div class="col-sm-6 col-md-6">
                    @if (Model.IsCompany == 1)
                    {
                        <div class="row my-2">
                            <label class="col-sm-1 col-md-2 col-form-label">@_f.tra("Společnost"):</label>
                            <div class="col-sm-11 col-md-10">
                                <input class="form-control" asp-for="Rec.p28CompanyName" />
                            </div>
                        </div>
                    }
                    @if (Model.IsCompany == 0)
                    {
                        <div class="row my-2">
                            <label class="col-sm-1 col-md-2 col-form-label">@_f.tra("Jméno"):</label>
                            <div class="col-sm-11 col-md-10">
                                <myautocomplete asp-for="Rec.p28TitleBeforeName" o15flag="1" placeholder="@_f.tra("Titul")"></myautocomplete>
                            </div>

                        </div>
                        <div class="row my-2">
                            <div class="col-sm-1 col-md-2"></div>
                            <div class="col-sm-11 col-md-10">
                                <input class="form-control" asp-for="Rec.p28FirstName" placeholder="@_f.tra("Křestní jméno")" />
                            </div>
                        </div>
                        <div class="row my-2">
                            <div class="col-sm-1 col-md-2"></div>
                            <div class="col-sm-11 col-md-10">
                                <input class="form-control" asp-for="Rec.p28LastName" placeholder="@_f.tra("Příjmení")" />
                            </div>
                        </div>
                        <div class="row my-2">
                            <div class="col-sm-1 col-md-2"></div>
                            <div class="col-sm-11 col-md-10">
                                <myautocomplete asp-for="Rec.p28TitleAfterName" o15flag="2" placeholder="@_f.tra("Za jménem")"></myautocomplete>
                            </div>
                        </div>

                    }

                    <div class="row my-2">
                        <label class="col-sm-1 col-md-2 col-form-label">@_f.tra("IČ"):</label>
                        <div class="col-sm-11 col-md-10">
                            <div class="input-group">
                                <input class="form-control" asp-for="Rec.p28RegID" />
                                <button type="button" class="btn btn-sm btn-outline-secondary" tabindex="-1">ARES import</button>
                            </div>

                        </div>

                    </div>
                    <div class="row my-2">
                        <label class="col-sm-1 col-md-2 col-form-label">@_f.tra("DIČ"):</label>
                        <div class="col-sm-11 col-md-10">
                            <div class="input-group">
                                <input class="form-control" asp-for="Rec.p28VatID" />
                                <button type="button" class="btn btn-sm btn-outline-secondary" tabindex="-1">VIES import</button>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="col-sm-6 col-md-6">
                    <div class="row my-2">
                        <input class="form-control" asp-for="Rec.p28CompanyShortName" placeholder="@_f.tra("Zkrácený (preferovaný) název klienta")" />
                    </div>
                    <div class="row my-2">
                        <div class="col-sm-1 col-md-2">@_f.tra("Kód klienta"):</div>
                        <div class="col-sm-11 col-md-10">
                            ??
                        </div>
                    </div>
                    <div class="row my-2">
                        <label class="col-sm-1 col-md-2 col-form-label">@_f.tra("Typ klienta"):</label>
                        <div class="col-sm-11 col-md-10">
                            <mycombo entity="p29ContactType" asp-for="Rec.p29ID" selectedtext="@Model.SelectedComboP29Name" view-flag="2"></mycombo>
                        </div>
                    </div>

                </div>
            </div>


            <div class="card">
                <div class="card-header">
                    @Html.Raw(BO.Symbol.o38())
                    @_f.tra("Adresy")
                    <button type="button" class="btn btn-sm btn-outline-secondary float-end" tabindex="-1" onclick="add_address()">@_f.tra("Přidat další adresu")</button>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-sm-2 col-md-2">
                            <label>@_f.tra("První (fakturační adresa)"):</label>
                            <br />
                            <input asp-for="@Model.RecFirstAddress.o38Name" placeholder="@_f.tra("Nadpis adresy")" />
                        </div>
                        <div class="col-sm-3 col-md-3 p-0">
                            <textarea asp-for="@Model.RecFirstAddress.o38Street" class="form-control" placeholder="@_f.tra("Ulice")"></textarea>
                        </div>
                        <div class="col-sm-3 col-md-3 p-0">
                            <textarea asp-for="@Model.RecFirstAddress.o38City" class="form-control" placeholder="@_f.tra("Město")"></textarea>
                        </div>

                        <div class="col-sm-1 col-md-1 p-0">
                            <input class="form-control" asp-for="@Model.RecFirstAddress.o38ZIP" placeholder="@_f.tra("PSČ")" />
                        </div>
                        <div class="col-sm-3 col-md-3">
                            <input class="form-control" asp-for="@Model.RecFirstAddress.o38Country" placeholder="@_f.tra("Stát")" />
                        </div>
                    </div>
                    @if (Model.lisO38.Count() > 0)
                    {                        
                        <label>@_f.tra("Další adresy"):</label>
                        <table class="table table-sm table-hover">
                            @foreach (var c in Model.lisO38)
                            {
                                <tr>
                                    <td>
                                        @(_f.tra(c.o36Name) +":")
                                    </td>
                                    <td>
                                        @c.o38Name
                                    </td>
                                    <td>
                                        @c.o38City
                                    </td>
                                    <td>
                                        @c.o38Street
                                    </td>
                                    <td>
                                        @c.o38ZIP
                                    </td>
                                    <td>
                                        @c.o38Country
                                    </td>
                                    <td width="80px">
                                        <button type="button" class="btn btn-sm btn-light" onclick="o38_edit(@(c.pid),@(c.o36ID))">@_f.tra("Upravit/Odstranit")</button>
                                    </td>
                                </tr>
                            }
                        </table>
                    }


                </div>
            </div>

            <div class="card my-2">
                <div class="card-header">
                    @Html.Raw(BO.Symbol.j02())
                    @_f.tra("Kontaktní osoby")
                    <div class="dropdown float-end">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                            @_f.tra("Přidat")
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                            <li><a class="dropdown-item" href="javascript:create_person()">@_f.tra("Založit novou osobu")</a></li>
                            <li><a class="dropdown-item" href="#">@_f.tra("Vazba na již založenou osobu")</a></li>                            
                        </ul>
                    </div>
                    
                </div>
                <div class="card-body">

                </div>
            </div>

            <div class="card my-2">
                <div class="card-header">@_f.tra("WIP limit k upozornění")</div>
                <div class="card-body">
                    <div class="row">
                        <label class="col-sm-4 col-md-4 col-form-label">@_f.tra("Limit rozpracovaných hodin v projektech klienta"):</label>
                        <div class="col-sm-2 col-md-2">
                            <mynumber asp-for="Rec.p28LimitHours_Notification" decimal-digits="2"></mynumber>
                        </div>
                    </div>
                    <div class="row my-2">
                        <label class="col-sm-4 col-md-4 col-form-label">@_f.tra("Limitní honorář z rozpracovaných hodin projektů klienta"):</label>
                        <div class="col-sm-2 col-md-2">
                            <mynumber asp-for="Rec.p28LimitFee_Notification" decimal-digits="2"></mynumber>
                        </div>
                    </div>
                </div>
            </div>



            <mystitky entity="p28Contact" asp-for="@Model.TagPids" tagnames="@Model.TagNames" taghtml="@Model.TagHtml" buttontext="@_f.tra("Oštítkovat")"></mystitky>


        </div>

        <div class="tab-pane" id="tab2" role="tabpanel">
            <!-- Tab2 -->

            <div class="row">
                <label class="col-sm-2 col-md-3 col-form-label">@_f.tra("Fakturační jazyk klienta"):</label>
                <div class="col-sm-10 col-md-9">
                    <mycombo entity="p87BillingLanguage" asp-for="Rec.p87ID" selectedtext="@Model.SelectedComboP87Name" view-flag="2"></mycombo>
                </div>
            </div>
            <div class="row my-2">
                <label class="col-sm-2 col-md-3 col-form-label">@_f.tra("Výchozí typ faktury"):</label>
                <div class="col-sm-10 col-md-9">
                    <mycombo entity="p92InvoiceType" asp-for="Rec.p92ID" selectedtext="@Model.SelectedComboP92Name" view-flag="2"></mycombo>
                </div>
            </div>
            <div class="row my-2">
                <div class="col-sm-2 col-md-3">@_f.tra("ISDOC kód státu"):</div>
                <div class="col-sm-10 col-md-9">
                    <input class="form-control" asp-for="Rec.p28Pohoda_VatCode" />
                </div>
            </div>
            <div class="row my-2">
                <div class="col-sm-2 col-md-3">@_f.tra("IČ DPH SK (Slovensko)"):</div>
                <div class="col-sm-10 col-md-9">
                    <input class="form-control" asp-for="Rec.p28ICDPH_SK" />
                </div>
            </div>
            <div class="row my-2">
                <div class="col-sm-2 col-md-3">@_f.tra("Výchozí splatnost faktury (dny)"):</div>
                <div class="col-sm-10 col-md-9">
                    <mynumber asp-for="Rec.p28InvoiceMaturityDays" decimal-digits="0"></mynumber>
                </div>
            </div>
            <div class="row my-2">
                <label class="col-sm-2 col-md-3 col-form-label">@_f.tra("Šablona zprávy pro elektronickou fakturaci"):</label>
                <div class="col-sm-10 col-md-9">
                    <mycombo entity="j61TextTemplate" asp-for="Rec.j61ID_Invoice" selectedtext="@Model.SelectedComboJ61Name" view-flag="2"></mycombo>
                </div>
            </div>
            <div class="row my-2">
                <div class="col-sm-2 col-md-3">@_f.tra("Režijní přirážka k ceně faktury"):</div>
                <div class="col-sm-10 col-md-9">
                    <mycombo entity="p63Overhead" asp-for="Rec.p63ID" selectedtext="@Model.SelectedComboP63Name" view-flag="2"></mycombo>
                </div>
            </div>

            <div class="form-floating my-2">
                <textarea class="form-control" style="background-color:#F0FFF0 !important;" asp-for="Rec.p28BillingMemo"></textarea>
                <label for="Rec_p28BillingMemo">@_f.tra("Interní fakturační poznámka klienta")</label>
            </div>


            <div class="form-floating my-2">
                <textarea class="form-control" asp-for="Rec.p28InvoiceDefaultText1"></textarea>
                <label for="Rec_p28InvoiceDefaultText1">@_f.tra("Výchozí hlavní text faktury")</label>
            </div>

            <div class="form-floating my-2">
                <textarea class="form-control" asp-for="Rec.p28InvoiceDefaultText2"></textarea>
                <label for="Rec_p28InvoiceDefaultText2">@_f.tra("Výchozí technický text faktury")</label>
            </div>
        </div>

        <div class="tab-pane" id="tab3" role="tabpanel">
            <!-- Tab3 -->


            @Html.EditorFor(m => m.ff1, "~/Views/Shared/_FreeFields.cshtml")

        </div>

        <div class="tab-pane" id="tab4" role="tabpanel">
            <!-- Tab4 -->
            <div class="row">
                <label class="col-sm-1 col-md-2 col-form-label">@_f.tra("Vlastník záznamu"):</label>
                <div class="col-sm-11 col-md-10">
                    <mycombo entity="j02Person" asp-for="Rec.j02ID_Owner" selectedtext="@Model.SelectedComboOwner" view-flag="1" myqueryinline="isintranonvirtualperson|bool|1"></mycombo>
                </div>
            </div>
            <div class="row my-2">
                <label class="col-sm-1 col-md-2 col-form-label">@_f.tra("Stromově nadřízený klient"):</label>
                <div class="col-sm-11 col-md-10">
                    <mycombo entity="p28Contact" asp-for="Rec.p28ParentID" selectedtext="@Model.SelectedComboParentP28Name" view-flag="1"></mycombo>
                </div>
            </div>
            <div class="row my-2">
                <div class="col-sm-1 col-md-2">@_f.tra("Rodné číslo"):</div>
                <div class="col-sm-11 col-md-10">
                    <input class="form-control" asp-for="Rec.p28Person_BirthRegID" />
                </div>
            </div>
            <div class="row my-2">
                <div class="col-sm-1 col-md-2">@_f.tra("Externí kód"):</div>
                <div class="col-sm-11 col-md-10">
                    <input class="form-control" asp-for="Rec.p28ExternalPID" />
                </div>
            </div>

        </div>

    </div>
</div>

<input type="hidden" asp-for="@Model.RecFirstAddress.pid" />
<input type="hidden" asp-for="@Model.TempGuid" />


<script type="text/javascript">
    $(document).ready(function () {




    });

    function postback(oper) {

        form1.action = _ep("/p28/Record?oper=" + oper);
        form1.submit();
    }


    function add_address() {
        _window_open(_ep("/o38/Record?o36id=2&pid=0&tempguid=@Model.TempGuid"));
    }
    function o38_edit(o38id,o36id) {
        _window_open(_ep("/o38/Record?pid="+o38id+"&o36id="+o36id+"&tempguid=@Model.TempGuid"));
    }
    function create_person() {
        _window_open(_ep("/j02/Record?isintraperson=false&pid=0&tempguid=@Model.TempGuid"));
    }

    function hardrefresh() {
        alert("hardrefresh");
        postback("postback");
    }
</script>
